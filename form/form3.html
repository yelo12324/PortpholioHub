<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portfolio - My Work</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="form3.css" />
</head>
<body>
  <a href="../index.html" class="brand-heading">PortpholioHub</a>
 
  <form id="work-form">

  <div class="container">
    <!-- Steps Header -->
    <div class="steps">
      <p><strong>Sign up</strong></p>
      <div class="step-indicators">
        <div class="line"></div>
        <div class="step">
          <div class="step-circle">1</div>
          Basic Details
        </div>
        <div class="step active">
          <div class="step-circle">2</div>
          Skill & Experience
        </div>
        <div class="step">
          <div class="step-circle">3</div>
          Contact Details
        </div>
      </div>
    </div>

   
    <!-- My Work Section -->
    <div class="section-title">My Work</div>

    <!-- Work Block 1 -->
    <div class="work-block">
      <div class="work-inputs">
        <div class="input-row">
          <input type="text" name="name1"  placeholder="ex: UI/UX , Python" />
          <input type="text" name="description1" placeholder="Description" />
        </div>
        <div class="add-link-wrapper">
          <img src="https://img.icons8.com/ios-glyphs/20/3c29ff/link.png" alt="link icon" />
          <input type="url" name="link1" placeholder="Add Link" />
        </div>
      </div>
      <div class="photo-upload">
        <label for="photo1">
          <div class="photo-box" id="preview1">
            <img src="https://img.icons8.com/ios-filled/24/808080/camera--v1.png" />
            <span>Add Photo</span>
          </div>
        </label>
        <input type="file" id="photo1" name="photo1" accept="image/*" />
      </div>
    </div>

    <!-- Work Block 2 -->
    <div class="work-block">
      <div class="work-inputs">
        <div class="input-row">
          <input type="text" name="name2" placeholder="ex: UI/UX , Python" />
          <input type="text" name="description2" placeholder="Description" />
        </div>
        <div class="add-link-wrapper">
          <img src="https://img.icons8.com/ios-glyphs/20/3c29ff/link.png" alt="link icon" />
          <input type="url" name="link2" placeholder="Add Link" />
        </div>
      </div>
      <div class="photo-upload">
        <label for="photo2">
          <div class="photo-box" id="preview2">
            <img src="https://img.icons8.com/ios-filled/24/808080/camera--v1.png" />
            <span>Add Photo</span>
          </div>
        </label>
        <input type="file" id="photo2" name="photo2"  accept="image/*" />
      </div>
    </div>

    <!-- Work Block 3 -->
    <div class="work-block">
      <div class="work-inputs">
        <div class="input-row">
          <input type="text" name="name3" placeholder="ex: UI/UX , Python" />
          <input type="text" name="description3" placeholder="Description" />
        </div>
        <div class="add-link-wrapper">
          <img src="https://img.icons8.com/ios-glyphs/20/3c29ff/link.png" alt="link icon" />
          <input type="url" name="link3" placeholder="Add Link" />
        </div>
      </div>
      <div class="photo-upload">
        <label for="photo3">
          <div class="photo-box" id="preview3">
            <img src="https://img.icons8.com/ios-filled/24/808080/camera--v1.png" />
            <span>Add Photo</span>
          </div>
        </label>
        <input type="file" id="photo3" name="photo3" accept="image/*" />
      </div>
    </div>

    <button class="save-btn" type="submit" href="form3.html">Save & Continue</button>
  </div>

 </form>
        <div id="alertBox" class="alert" style="display: none;"></div>

  <!-- <script src="form3.js"></script>  -->


<script>
document.addEventListener('DOMContentLoaded', () => {
    const workForm = document.getElementById('work-form');
    const alertBox = document.getElementById('alertBox');

    // Image preview logic for each work block
    [1,2,3].forEach(i => {
        const photoInput = document.getElementById(`photo${i}`);
        const previewBox = document.getElementById(`preview${i}`);
        photoInput.addEventListener('change', function () {
            const file = photoInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewBox.innerHTML = `<img src="${e.target.result}" style="width:60px;height:60px;border-radius:8px;" />`;
                };
                reader.readAsDataURL(file);
            }
        });
    });

    function showAlert(message) {
        alertBox.textContent = message;
        alertBox.className = 'alert error';
        alertBox.style.display = 'block';
        setTimeout(() => { alertBox.style.display = 'none'; }, 3000);
    }

    
    // Helper to convert file to DataURL
    function fileToDataURL(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => resolve(e.target.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    workForm.addEventListener('submit', async(event) => {
        event.preventDefault();

        const projects = [];
        const workBlocks = document.querySelectorAll('.work-block');

        // Collect project data (do NOT store images in sessionStorage)
        for (let index = 0; index < workBlocks.length; index++) {
            const block = workBlocks[index];
            const name = block.querySelector(`input[name="name${index + 1}"]`)?.value.trim();
            const description = block.querySelector(`input[name="description${index + 1}"]`)?.value.trim();
            const link = block.querySelector(`input[name="link${index + 1}"]`)?.value.trim();
                        const photoInput = block.querySelector(`input[type="file"]`);
            let photoDataURL = "";
         if (name) {
                if (photoInput && photoInput.files[0]) {
                    photoDataURL = await fileToDataURL(photoInput.files[0]);
                }
                projects.push({ name, description, link, photo: photoDataURL });
            }
        }

        if (projects.length === 0) {
            return showAlert("Please add at least one project.");
        }

        try {
            sessionStorage.setItem('portfolioStep3', JSON.stringify({ projects }));
            window.location.href = 'form4.html';
        } catch (error) {
            showAlert("Error saving your progress. Please try again.");
            console.error("sessionStorage error:", error);
        }
    });
});
</script>

</body>
</html>
